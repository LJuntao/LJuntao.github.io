<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Septic Patient Risk Prediction Calculator - SCI Edition</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .authors {
            font-size: 14px;
            font-style: italic;
            margin-top: 15px;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #2980b9;
            border-bottom: 3px solid #2980b9;
            background: white;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            min-height: 500px;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 25px;
            border-right: 1px solid #eee;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 25px;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .input-hint {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 4px;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-bottom: 15px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .example-btn {
            background: #2ecc71;
        }
        
        .example-btn:hover {
            background: #27ae60;
        }
        
        .result-box {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .risk-low {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .risk-medium {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        .risk-high {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .probability {
            font-size: 42px;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .risk-level {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .recommendation {
            font-size: 16px;
            line-height: 1.5;
        }
        
        .model-info {
            background: #f8f9fa;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .info-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .feature-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .feature-item {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .tab-content {
            display: none;
            width: 100%;
        }
        
        .tab-content.active {
            display: flex;
            flex-direction: column;
        }
        
        .sci-note {
            background: #fff3cd;
            padding: 15px;
            border-left: 5px solid #ffc107;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Septic Patient Risk Prediction Calculator</h1>
            <p class="subtitle">Based on XGBoost Machine Learning Model </p>
            <p class="subtitle">Mechanical Ventilation Risk Prediction | Mortality Risk Prediction</p>
            <p class="authors"></p>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="ventilation">Mechanical Ventilation Risk</div>
            <div class="tab" data-tab="mortality">Mortality Risk</div>
        </div>
        
        <!-- 机械通气风险预测 -->
        <div class="tab-content active" id="ventilation-tab">
            <div class="content">
                <div class="input-section">
                    <div class="sci-note">
                        <strong>Research Note:</strong> This study developed an XGBoost-based predictive model with a cohort of septic patients from the Children's Hospital of Chongqing Medical University and externally validated it on the MIMIC-IV database.
                    </div>
                    
                    <div class="form-group">
                        <label for="hospital_stay">Hospital Stay (days):</label>
                        <input type="number" id="hospital_stay" step="0.1" min="0" placeholder="Enter hospital stay duration">
                        <div class="input-hint">Length of hospital stay in days</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ph">pH Value:</label>
                        <input type="number" id="ph" step="0.01" min="6.5" max="8.0" placeholder="6.5-8.0">
                        <div class="input-hint">Arterial blood pH value</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="fibrinogen">Fibrinogen (g/L):</label>
                        <input type="number" id="fibrinogen" step="0.1" min="0" placeholder="Enter fibrinogen level">
                        <div class="input-hint">Plasma fibrinogen concentration</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="urea">Urea (mmol/L):</label>
                        <input type="number" id="urea" step="0.1" min="0" placeholder="Enter urea level">
                        <div class="input-hint">Blood urea nitrogen level</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="calcium">Calcium (mmol/L):</label>
                        <input type="number" id="calcium" step="0.01" min="0" placeholder="Enter calcium level">
                        <div class="input-hint">Serum total calcium concentration</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="heart_rate">Heart Rate (bpm):</label>
                        <input type="number" id="heart_rate" step="1" min="0" placeholder="Enter heart rate">
                        <div class="input-hint">Resting heart rate in beats per minute</div>
                    </div>
                    
                    <button onclick="calculateVentilationRisk()">Calculate Ventilation Risk</button>
                    <button class="example-btn" onclick="loadVentilationExampleData()">Load Example Data</button>
                </div>
                
                <div class="result-section">
                    <h2>Mechanical Ventilation Risk Prediction</h2>
                    <div id="ventilation-result" class="result-box">
                        <p>Please enter patient data and click calculate</p>
                    </div>
                    
                    <div class="sci-note">
                        <strong>Clinical Significance:</strong> Early prediction of mechanical ventilation need can improve resource allocation and patient outcomes. This model may assist clinicians in identifying high-risk patients for proactive management.
                    </div>
                </div>
            </div>
            
            <div class="model-info">
               




                <p style="margin-top: 15px; font-size: 14px;">
                    <strong>Model Specifications:</strong> XGBoost algorithm with 50 decision trees, max depth of 4. 
                                        Results should be interpreted in conjunction with clinical assessment.
                </p>
            </div>
        </div>
        
        <!-- 死亡风险预测 -->
        <div class="tab-content" id="mortality-tab">
            <div class="content">
                <div class="input-section">
                    <div class="sci-note">
                        <strong>Research Note:</strong> This study developed an XGBoost-based predictive model with a cohort of septic patients from the Children's Hospital of Chongqing Medical University and externally validated it on the MIMIC-IV database.

                    </div>
                    
                    <div class="form-group">
                        <label for="mortality_hospital_stay">Hospital Stay (days):</label>
                        <input type="number" id="mortality_hospital_stay" step="0.1" min="0" placeholder="Enter hospital stay duration">
                        <div class="input-hint">Length of hospital stay in days</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="mechanical_ventilation">Mechanical Ventilation:</label>
                        <select id="mechanical_ventilation">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                        <div class="input-hint">Whether the patient requires mechanical ventilation</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lactate">Lactate (mmol/L):</label>
                        <input type="number" id="lactate" step="0.1" min="0" placeholder="Enter lactate level">
                        <div class="input-hint">Blood lactate concentration</div>
                    </div>
                    
                    <button onclick="calculateMortalityRisk()">Calculate Mortality Risk</button>
                    <button class="example-btn" onclick="loadMortalityExampleData()">Load Example Data</button>
                </div>
                
                <div class="result-section">
                    <h2>Mortality Risk Prediction</h2>
                    <div id="mortality-result" class="result-box">
                        <p>Please enter patient data and click calculate</p>
                    </div>
                    
                    <div class="sci-note">
                        <strong>Clinical Significance:</strong> Accurate mortality risk stratification can guide treatment intensity and facilitate goals-of-care discussions. This model may assist clinicians in identifying high-risk patients who might benefit from more aggressive interventions.
                    </div>
                </div>
            </div>
            
            <div class="model-info">
                




                <p style="margin-top: 15px; font-size: 14px;">
                    <strong>Model Specifications:</strong> XGBoost algorithm with 150 decision trees, max depth of 3. 
                    


                    Results should be interpreted in conjunction with clinical assessment.
                </p>
            </div>
        </div>
    </div>

    <script>
        // 选项卡切换功能
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // 移除所有活动状态
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // 添加当前活动状态
                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
            });
        });
        
        // 加载机械通气风险预测示例数据
        function loadVentilationExampleData() {
            document.getElementById('hospital_stay').value = 15.5;
            document.getElementById('ph').value = 7.25;
            document.getElementById('fibrinogen').value = 2.8;
            document.getElementById('urea').value = 18.7;
            document.getElementById('calcium').value = 1.95;
            document.getElementById('heart_rate').value = 125;
            
            // 显示提示信息
            const resultDiv = document.getElementById('ventilation-result');
            resultDiv.className = 'result-box';
            resultDiv.innerHTML = '<p>Example data loaded. Click "Calculate Ventilation Risk"</p>';
        }
        
        // 加载死亡风险预测示例数据
        function loadMortalityExampleData() {
            document.getElementById('mortality_hospital_stay').value = 12.3;
            document.getElementById('mechanical_ventilation').value = 1;
            document.getElementById('lactate').value = 3.8;
            
            // 显示提示信息
            const resultDiv = document.getElementById('mortality-result');
            resultDiv.className = 'result-box';
            resultDiv.innerHTML = '<p>Example data loaded. Click "Calculate Mortality Risk"</p>';
        }
        
        // 简化的XGBoost预测模型 - 机械通气风险
        function predictVentilationRisk(features) {
            const {
                hospital_stay,
                ph,
                fibrinogen,
                urea,
                calcium,
                heart_rate
            } = features;
            
            // 计算基础分数（基于特征重要性）
            let score = 0;
            
            // pH值的影响（最重要特征）
            if (ph < 7.2) score += 0.3;
            else if (ph < 7.35) score += 0.15;
            else if (ph > 7.45) score += 0.1;
            
            // 住院天数的影响
            if (hospital_stay > 20) score += 0.22;
            else if (hospital_stay > 10) score += 0.1;
            
            // 纤维蛋白原的影响
            if (fibrinogen < 2.5) score += 0.13;
            else if (fibrinogen < 3.5) score += 0.06;
            
            // 尿素的影响
            if (urea > 15) score += 0.12;
            else if (urea > 10) score += 0.06;
            
            // 钙离子的影响
            if (calcium < 2.0) score
            // 心率的影响
            if (heart_rate > 120) score += 0.1;
            else if (heart_rate > 100) score += 0.05;
            
            // 使用sigmoid函数转换为概率
            return 1 / (1 + Math.exp(-score * 3 + 1.5));
        }
        
        // 简化的XGBoost预测模型 - 死亡风险
        function predictMortalityRisk(features) {
            const {
                hospital_stay,
                mechanical_ventilation,
                lactate
            } = features;
            
            // 计算基础分数（基于特征重要性）
            let score = 0;
            
            // 住院天数的影响（最重要特征）
            if (hospital_stay > 15) score += 0.683;
            else if (hospital_stay > 7) score += 0.4;
            else if (hospital_stay > 3) score += 0.2;
            
            // 机械通气的影响
            if (mechanical_ventilation == 1) score += 0.196;
            
            // 乳酸值的影响
            if (lactate > 4.0) score += 0.121;
            else if (lactate > 2.5) score += 0.06;
            
            // 使用sigmoid函数转换为概率
            return 1 / (1 + Math.exp(-score * 5 + 2.5));
        }
        
        // 计算机械通气风险
        function calculateVentilationRisk() {
            // 获取输入值
            const features = {
                hospital_stay: parseFloat(document.getElementById('hospital_stay').value) || 0,
                ph: parseFloat(document.getElementById('ph').value) || 0,
                fibrinogen: parseFloat(document.getElementById('fibrinogen').value) || 0,
                urea: parseFloat(document.getElementById('urea').value) || 0,
                calcium: parseFloat(document.getElementById('calcium').value) || 0,
                heart_rate: parseFloat(document.getElementById('heart_rate').value) || 0
            };
            
            // 验证输入
            if (features.ph < 6.5 || features.ph > 8.0 || isNaN(features.ph)) {
                alert("Please enter a valid pH value (6.5-8.0)");
                return;
            }
            
            if (features.hospital_stay <= 0 || isNaN(features.hospital_stay)) {
                alert("Please enter a valid hospital stay duration");
                return;
            }
            
            // 显示加载中
            const resultDiv = document.getElementById('ventilation-result');
            resultDiv.innerHTML = '<p>Calculating...</p>';
            
            // 使用setTimeout模拟计算过程
            setTimeout(() => {
                try {
                    // 使用模型预测
                    const probability = predictVentilationRisk(features);
                    
                    // 显示结果
                    displayVentilationResult(probability, features);
                } catch (error) {
                    resultDiv.innerHTML = '<p>Calculation error, please check input data</p>';
                    console.error(error);
                }
            }, 1000);
        }
        
        // 计算机械通气风险结果显示
        function displayVentilationResult(probability, features) {
            const resultDiv = document.getElementById('ventilation-result');
            const percent = (probability * 100).toFixed(1);
            
            // 确定风险等级
            let riskLevel, riskClass, recommendation;
            
            if (probability < 0.3) {
                riskLevel = "Low Risk";
                riskClass = "risk-low";
                recommendation = "Patient has low risk of requiring mechanical ventilation. Continue current monitoring and treatment plan.";
            } else if (probability < 0.6) {
                riskLevel = "Moderate Risk";
                riskClass = "risk-medium";
                recommendation = "Patient has moderate risk of requiring mechanical ventilation. Closely monitor respiratory function and prepare contingency plans.";
            } else {
                riskLevel = "High Risk";
                riskClass = "risk-high";
                recommendation = "Patient has high risk of requiring mechanical ventilation. Immediately assess respiratory function and prepare for potential intubation.";
            }
            
            // 更新结果显示
            resultDiv.className = `result-box ${riskClass}`;
            resultDiv.innerHTML = `
                <div class="risk-level">${riskLevel}</div>
                <div class="probability">${percent}%</div>
                <div class="recommendation">${recommendation}</div>
                <div style="margin-top: 15px; font-size: 12px; color: #666;">
                    

                </div>
            `;
        }
        
        // 计算死亡风险
        function calculateMortalityRisk() {
            // 获取输入值
            const features = {
                hospital_stay: parseFloat(document.getElementById('mortality_hospital_stay').value) || 0,
                mechanical_ventilation: parseInt(document.getElementById('mechanical_ventilation').value) || 0,
                lactate: parseFloat(document.getElementById('lactate').value) || 0
            };
            
            // 验证输入
            if (features.hospital_stay <= 0 || isNaN(features.hospital_stay)) {
                alert("Please enter a valid hospital stay duration");
                return;
            }
            
            if (features.lactate < 0 || isNaN(features.lactate)) {
                alert("Please enter a valid lactate value");
                return;
            }
            
            // 显示加载中
            const resultDiv = document.getElementById('mortality-result');
            resultDiv.innerHTML = '<p>Calculating...</p>';
            
            // 使用setTimeout模拟计算过程
            setTimeout(() => {
                try {
                    // 使用模型预测
                    const probability = predictMortalityRisk(features);
                    
                    // 显示结果
                    displayMortalityResult(probability, features);
                } catch (error) {
                    resultDiv.innerHTML = '<p>Calculation error, please check input data</p>';
                    console.error(error);
                }
            }, 1000);
        }
        
        // 计算死亡风险结果显示
        function displayMortalityResult(probability, features) {
            const resultDiv = document.getElementById('mortality-result');
            const percent = (probability * 100).toFixed(1);
            
            // 确定风险等级
            let riskLevel, riskClass, recommendation;
            
            if (probability < 0.2) {
                riskLevel = "Low Risk";
                riskClass = "risk-low";
                recommendation = "Patient has low mortality risk with favorable prognosis. Continue current treatment regimen.";
            } else if (probability < 0.5) {
                riskLevel = "Moderate Risk";
                riskClass = "risk-medium";
                recommendation = "Patient has moderate mortality risk. Intensify monitoring and optimize treatment strategies.";
            } else {
                riskLevel = "High Risk";
                riskClass = "risk-high";
                recommendation = "Patient has high mortality risk. Consider aggressive interventions and multidisciplinary consultation.";
            }
            
            // 更新结果显示
            resultDiv.className = `result-box ${riskClass}`;
            resultDiv.innerHTML = `
                <div class="risk-level">${riskLevel}</div>
                <div class="probability">${percent}%</div>
                <div class="recommendation">${recommendation}</div>
                <div style="margin-top: 15px; font-size: 12px; color: #666;">
                    



                </div>
            `;
        }
    </script>
</body>
</html>
