<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>脓毒症机械通气风险预测计算器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        header {
            background: #3498db;
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .input-section {
            flex: 1;
            min-width: 300px;
            padding: 25px;
            border-right: 1px solid #eee;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 25px;
            background: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .result-box {
            flex: 1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .risk-low {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .risk-medium {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeaa7;
        }
        
        .risk-high {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .probability {
            font-size: 42px;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .risk-level {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .recommendation {
            font-size: 16px;
            line-height: 1.5;
        }
        
        .model-info {
            background: #f8f9fa;
            padding: 20px;
            border-top: 1px solid #eee;
        }
        
        .info-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
        }
        
        .feature-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .feature-item {
            background: #e9ecef;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #eee;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>脓毒症机械通气风险预测计算器</h1>
            <p class="subtitle">基于XGBoost机器学习模型 - AUC: 0.8126 | 准确率: 95.0%</p>
        </header>
        
        <div class="content">
            <div class="input-section">
                <div class="form-group">
                    <label for="hospital_stay">住院天数 (Hospital_stay_days):</label>
                    <input type="number" id="hospital_stay" step="0.1" min="0" placeholder="请输入住院天数">
                </div>
                
                <div class="form-group">
                    <label for="ph">pH值 (PH):</label>
                    <input type="number" id="ph" step="0.01" min="6.5" max="8.0" placeholder="6.5-8.0">
                </div>
                
                <div class="form-group">
                    <label for="fibrinogen">纤维蛋白原 (Fibrinogen, g/L):</label>
                    <input type="number" id="fibrinogen" step="0.1" min="0" placeholder="请输入纤维蛋白原值">
                </div>
                
                <div class="form-group">
                    <label for="urea">尿素 (Urea, mmol/L):</label>
                    <input type="number" id="urea" step="0.1" min="0" placeholder="请输入尿素值">
                </div>
                
                <div class="form-group">
                    <label for="calcium">钙离子 (Calcium_total, mmol/L):</label>
                    <input type="number" id="calcium" step="0.01" min="0" placeholder="请输入钙离子值">
                </div>
                
                <div class="form-group">
                    <label for="heart_rate">心率 (Heart_rate, 次/分):</label>
                    <input type="number" id="heart_rate" step="1" min="0" placeholder="请输入心率">
                </div>
                
                <button onclick="calculateRisk()">计算机械通气风险</button>
            </div>
            
            <div class="result-section">
                <h2>预测结果</h2>
                <div id="result" class="result-box">
                    <p>请输入患者数据并点击计算按钮</p>
                </div>
            </div>
        </div>
        
        <div class="model-info">
            <div class="info-title">模型特征重要性</div>
            <div class="feature-list">
                <div class="feature-item">PH (29.9%)</div>
                <div class="feature-item">住院天数 (22.0%)</div>
                <div class="feature-item">纤维蛋白原 (12.9%)</div>
                <div class="feature-item">尿素 (12.4%)</div>
                <div class="feature-item">钙离子 (12.2%)</div>
                <div class="feature-item">心率 (10.5%)</div>
            </div>
            <p style="margin-top: 15px; font-size: 14px;">注：本预测工具基于XGBoost机器学习模型，包含50棵决策树，最大深度4层。计算结果仅供参考，临床决策需结合患者全面情况。</p>
        </div>
    </div>

    <script>
        // 特征映射
        const featureMapping = {
            'f0': 'hospital_stay',
            'f1': 'ph', 
            'f2': 'fibrinogen',
            'f3': 'urea',
            'f4': 'calcium',
            'f5': 'heart_rate'
        };

        // 完整的XGBoost树结构（50棵树）
        const trees = [
            // 树0
            {
                "nodeid": 0,
                "split": "f1",
                "split_condition": 7.36007404,
                "yes": 1,
                "no": 2,
                "missing": 1,
                "children": [
                    {
                        "nodeid": 1,
                        "split": "f4",
                        "split_condition": 2.10500002,
                        "yes": 3,
                        "no": 4,
                        "children": [
                            {
                                "nodeid": 3,
                                "split": "f2",
                                "split_condition": 3.13000011,
                                "yes": 7,
                                "no": 8,
                                "children": [
                                    {
                                        "nodeid": 7,
                                        "split": "f3",
                                        "split_condition": 18.4899998,
                                        "yes": 15,
                                        "no": 16,
                                        "children": [
                                            {"nodeid": 15, "leaf": 0.311111122},
                                            {"nodeid": 16, "leaf": 0.0923076943}
                                        ]
                                    },
                                    {
                                        "nodeid": 8,
                                        "split": "f2",
                                        "split_condition": 3.74499989,
                                        "yes": 17,
                                        "no": 18,
                                        "children": [
                                            {"nodeid": 17, "leaf": -0.13333334},
                                            {"nodeid": 18, "leaf": 0.211764723}
                                        ]
                                    }
                                ]
                            },
                            {
                                "nodeid": 4,
                                "split": "f5",
                                "split_condition": 158,
                                "yes": 9,
                                "no": 10,
                                "children": [
                                    {
                                        "nodeid": 9,
                                        "split": "f0",
                                        "split_condition": 18.7071571,
                                        "yes": 19,
                                        "no": 20,
                                        "children": [
                                            {"nodeid": 19, "leaf": -0.174999997},
                                            {"nodeid": 20, "leaf": 0.0444444455}
                                        ]
                                    },
                                    {
                                        "nodeid": 10,
                                        "split": "f4",
                                        "split_condition": 2.24499989,
                                        "yes": 21,
                                        "no": 22,
                                        "children": [
                                            {"nodeid": 21, "leaf": 0.0363636389},
                                            {"nodeid": 22, "leaf": 0.25454545}
                                        ]
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "nodeid": 2,
                        "split": "f0",
                        "split_condition": 24.1954002,
                        "yes": 5,
                        "no": 6,
                        "children": [
                            {
                                "nodeid": 5,
                                "split": "f1",
                                "split_condition": 7.54250002,
                                "yes": 11,
                                "no": 12,
                                "children": [
                                    {
                                        "nodeid": 11,
                                        "split": "f5",
                                        "split_condition": 153.5,
                                        "yes": 23,
                                        "no": 24,
                                        "children": [
                                            {"nodeid": 23, "leaf": -0.264935076},
                                            {"nodeid": 24, "leaf": -0.089552246}
                                        ]
                                    },
                                    {
                                        "nodeid": 12,
                                        "split": "f1",
                                        "split_condition": 7.56650019,
                                        "yes": 25,
                                        "no": 26,
                                        "children": [
                                            {"nodeid": 25, "leaf": 0.15384616},
                                            {"nodeid": 26, "leaf": -0.0444444455}
                                        ]
                                    }
                                ]
                            },
                            {
                                "nodeid": 6,
                                "split": "f2",
                                "split_condition": 4.54500008,
                                "yes": 13,
                                "no": 14,
                                "children": [
                                    {
                                        "nodeid": 13,
                                        "split": "f4",
                                        "split_condition": 2.25,
                                        "yes": 27,
                                        "no": 28,
                                        "children": [
                                            {"nodeid": 27, "leaf": 0.237037048},
                                            {"nodeid": 28, "leaf": -0.0285714306}
                                        ]
                                    },
                                    {
                                        "nodeid": 14,
                                        "split": "f3",
                                        "split_condition": 4.81499958,
                                        "yes": 29,
                                        "no": 30,
                                        "children": [
                                            {"nodeid": 29, "leaf": -0.139534876},
                                            {"nodeid": 30, "leaf": 0.0705882385}
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            },
            // 树1
            {
                "nodeid": 0,
                "split": "f1",
                "split_condition": 7.36007404,
                "yes": 1,
                "no": 2,
                "missing": 1,
                "children": [
                    {
                        "nodeid": 1,
                        "split": "f4",
                        "split_condition": 2.10500002,
                        "yes": 3,
                        "no": 4,
                        "children": [
                            {
                                "nodeid": 3,
                                "split": "f2",
                                "split_condition": 1.95500004,
                                "yes": 7,
                                "no": 8,
                                "children": [
                                    {
                                        "nodeid": 7,
                                        "split": "f4",
                                        "split_condition": 2.01499987,
                                        "yes": 15,
                                        "no": 16,
                                        "children": [
                                            {"nodeid": 15, "leaf": 0.297809929},
                                            {"nodeid": 16, "leaf": 0.124545828}
                                        ]
                                    },
                                    {
                                        "nodeid": 8,
                                        "split": "f2",
                                        "split_condition": 2.20499992,
                                        "yes": 17,
                                        "no": 18,
                                        "children": [
                                            {"nodeid": 17, "leaf": -0.0797917917},
                                            {"nodeid": 18, "leaf": 0.176686466}
                                        ]
                                    }
                                ]
                            },
                            {
                                "nodeid": 4,
                                "split": "f5",
                                "split_condition": 158,
                                "yes": 9,
                                "no": 10,
                                "children": [
                                    {
                                        "nodeid": 9,
                                        "split": "f0",
                                        "split_condition": 11.0361862,
                                        "yes": 19,
                                        "no": 20,
                                        "children": [
                                            {"nodeid": 19, "leaf": -0.205251977},
                                            {"nodeid": 20, "leaf": 0.0116486168}
                                        ]
                                    },
                                    {
                                        "nodeid": 10,
                                        "split": "f2",
                                        "split_condition": 2.93499994,
                                        "yes": 21,
                                        "no": 22,
                                        "children": [
                                            {"nodeid": 21, "leaf": 0.0596774779},
                                            {"nodeid": 22, "leaf": 0.267174214}
                                        ]
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "nodeid": 2,
                        "split": "f0",
                        "split_condition": 22.5197868,
                        "yes": 5,
                        "no": 6,
                        "children": [
                            {
                                "nodeid": 5,
                                "split": "f2",
                                "split_condition": 3.41499996,
                                "yes": 11,
                                "no": 12,
                                "children": [
                                    {
                                        "nodeid": 11,
                                        "split": "f1",
                                        "split_condition": 7.4790926,
                                        "yes": 23,
                                        "no": 24,
                                        "children": [
                                            {"nodeid": 23, "leaf": -0.143935725},
                                            {"nodeid": 24, "leaf": 0.0385474078}
                                        ]
                                    },
                                    {
                                        "nodeid": 12,
                                        "split": "f0",
                                        "split_condition": 13.255353,
                                        "yes": 25,
                                        "no": 26,
                                        "children": [
                                            {"nodeid": 25, "leaf": -0.289112449},
                                            {"nodeid": 26, "leaf": -0.129180238}
                                        ]
                                    }
                                ]
                            },
                            {
                                "nodeid": 6,
                                "split": "f2",
                                "split_condition": 4.96000004,
                                "yes": 13,
                                "no": 14,
                                "children": [
                                    {
                                        "nodeid": 13,
                                        "split": "f3",
                                        "split_condition": 7.44999981,
                                        "yes": 27,
                                        "no": 28,
                                        "children": [
                                            {"nodeid": 27, "
